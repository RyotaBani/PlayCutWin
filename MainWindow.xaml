<Window x:Class="PlayCutWin.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:PlayCutWin.ViewModels"
        xmlns:models="clr-namespace:PlayCutWin.Models"
        Title="Play Cut" Width="1200" Height="800"
        Background="#111">
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <Style TargetType="Border">
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Background" Value="#1F1F1F"/>
            <Setter Property="Padding" Value="10"/>
        </Style>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="#EAEAEA"/>
        </Style>

        <Style TargetType="Button">
            <Setter Property="Margin" Value="0,0,6,0"/>
            <Setter Property="Padding" Value="10,6"/>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="0,2,0,0"/>
            <Setter Property="Background" Value="#2A2A2A"/>
            <Setter Property="Foreground" Value="#EAEAEA"/>
            <Setter Property="BorderBrush" Value="#3A3A3A"/>
        </Style>

        <DataTemplate DataType="{x:Type models:Clip}">
            <StackPanel Orientation="Vertical" Margin="0,0,0,8">
                <TextBlock Text="{Binding RangeText}" FontWeight="SemiBold"/>
                <TextBlock Text="{Binding TagsText}" Foreground="#BDBDBD" TextWrapping="Wrap"/>
            </StackPanel>
        </DataTemplate>
    </Window.Resources>

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 左上：Video -->
        <Border Grid.Row="0" Grid.Column="0" Margin="0,0,8,8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- ファイル名 -->
                <TextBlock Text="{Binding VideoTitle}" FontWeight="SemiBold" TextTrimming="CharacterEllipsis"/>

                <!-- Team入力 -->
                <Grid Grid.Row="1" Margin="0,8,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Team A" Foreground="#BDBDBD" FontSize="11"/>
                        <TextBox Text="{Binding TeamAName}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="8,0,0,0">
                        <TextBlock Text="Team B" Foreground="#BDBDBD" FontSize="11"/>
                        <TextBox Text="{Binding TeamBName}"/>
                    </StackPanel>
                </Grid>

                <!-- Video表示（MediaElement） -->
                <Border Grid.Row="2" Background="#0F0F0F" CornerRadius="10" Padding="0">
                    <Grid>
                        <MediaElement x:Name="Player"
                                      LoadedBehavior="Manual"
                                      UnloadedBehavior="Manual"
                                      Stretch="Uniform"
                                      />
                        <!-- ロード前の案内 -->
                        <TextBlock Text="Load video from the button →"
                                   Foreground="#777"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   FontSize="16"
                                   Visibility="{Binding IsVideoLoaded, Converter={x:Static BooleanBox.False}}"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- 左下：Controls -->
        <Border Grid.Row="1" Grid.Column="0" Margin="0,0,8,0">
            <StackPanel>

                <TextBlock Text="Controls" FontWeight="SemiBold" FontSize="16" Margin="0,0,0,8"/>

                <TextBlock Text="Playback Speed" Foreground="#BDBDBD" Margin="0,0,0,6"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <Button Content="0.25x" Command="{Binding SetSpeed025Command}"/>
                    <Button Content="0.5x" Command="{Binding SetSpeed05Command}"/>
                    <Button Content="1x" Command="{Binding SetSpeed1Command}"/>
                    <Button Content="2x" Command="{Binding SetSpeed2Command}" Margin="0,0,0,0"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                    <Button Content="-5s" Command="{Binding SeekMinus5Command}"/>
                    <Button Content="-1s" Command="{Binding SeekMinus1Command}"/>
                    <Button Content="Play/Pause" Click="PlayPause_Click"/>
                    <Button Content="+1s" Command="{Binding SeekPlus1Command}"/>
                    <Button Content="+5s" Command="{Binding SeekPlus5Command}" Margin="0,0,0,0"/>
                </StackPanel>

                <TextBlock Text="Clip Range" FontWeight="SemiBold" Margin="0,0,0,6"/>

                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0" Content="Clip START" Command="{Binding ClipStartCommand}" />
                    <TextBlock Grid.Column="1" Text="{Binding ClipStartText}" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="8,0,0,0" Foreground="#BDBDBD"/>

                    <TextBlock Grid.Column="2" Text="-" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="#777"/>

                    <Button Grid.Column="3" Content="Clip END" Command="{Binding ClipEndCommand}" />
                    <TextBlock Grid.Column="4" Text="{Binding ClipEndText}" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="8,0,0,0" Foreground="#BDBDBD"/>
                </Grid>

                <StackPanel Orientation="Horizontal">
                    <Button Content="Save Team A" Command="{Binding SaveTeamACommand}"/>
                    <Button Content="Save Team B" Command="{Binding SaveTeamBCommand}" Margin="0,0,0,0"/>
                </StackPanel>

            </StackPanel>
        </Border>

        <!-- 右上：Clips -->
        <Border Grid.Row="0" Grid.Column="1" Margin="0,0,0,8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- ヘッダー：Filter + Import/Export + Load Video（右端固定） -->
                <DockPanel LastChildFill="False">
                    <TextBlock Text="Clips (Total)" FontWeight="SemiBold" FontSize="16" DockPanel.Dock="Left"/>

                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                        <ComboBox Width="120" Margin="0,0,8,0">
                            <ComboBoxItem Content="All Clips" IsSelected="True"/>
                        </ComboBox>
                        <Button Content="Import CSV" Command="{Binding ImportCsvCommand}"/>
                        <Button Content="Export CSV" Command="{Binding ExportCsvCommand}"/>
                        <Button Content="Export All" Command="{Binding ExportAllCommand}"/>
                        <Button Content="Load Video" Command="{Binding LoadVideoCommand}" Margin="0"/>
                    </StackPanel>
                </DockPanel>

                <!-- Clips側にもファイル名 -->
                <TextBlock Grid.Row="1" Text="{Binding VideoTitle}" Foreground="#BDBDBD"
                           Margin="0,8,0,8" TextTrimming="CharacterEllipsis"/>

                <Grid Grid.Row="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                        <TextBlock Text="Team A Clips" Foreground="#BDBDBD" Margin="0,0,0,6"/>
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding TeamAClips}"/>
                        </ScrollViewer>
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                        <TextBlock Text="Team B Clips" Foreground="#BDBDBD" Margin="0,0,0,6"/>
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding TeamBClips}"/>
                        </ScrollViewer>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>

        <!-- 右下：Tags -->
        <Border Grid.Row="1" Grid.Column="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <DockPanel>
                    <TextBlock Text="Tags" FontWeight="SemiBold" FontSize="16" DockPanel.Dock="Left"/>
                    <Button Content="Preferences..." DockPanel.Dock="Right" Margin="0" Click="Preferences_Click"/>
                </DockPanel>

                <TextBlock Grid.Row="1" Text="Offense / Defense Tags" Foreground="#BDBDBD" Margin="0,8,0,8"/>

                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding Tags}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type models:TagItem}">
                                <ToggleButton IsChecked="{Binding IsSelected}"
                                              Content="{Binding Name}"
                                              Margin="0,0,8,8"
                                              Padding="10,6"
                                              Background="#2A2A2A"
                                              Foreground="#EAEAEA"
                                              BorderBrush="#3A3A3A"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <Grid Grid.Row="3" Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0" Text="{Binding CustomTag}" Height="30" VerticalContentAlignment="Center" />
                    <Button Grid.Column="1" Content="Add" Command="{Binding AddCustomTagCommand}" Margin="8,0,6,0"/>
                    <Button Grid.Column="2" Content="Clear" Command="{Binding ClearTagsCommand}" Margin="0"/>
                </Grid>
            </Grid>
        </Border>

    </Grid>
</Window>
